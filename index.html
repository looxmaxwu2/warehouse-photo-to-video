<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resimden Videoya D√∂n√º≈üt√ºr√ºc√º</title>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --dark: #1b263b;
            --light: #f8f9fa;
            --danger: #ef233c;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #e9ecef;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
            font-weight: 700;
        }
        .upload-area {
            border: 3px dashed #adb5bd;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
            position: relative;
        }
        .upload-area:hover {
            border-color: var(--primary);
            background-color: #f1f3f5;
        }
        .upload-area.active {
            border-color: var(--primary);
            background-color: #e9ecef;
        }
        .settings {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        input[type="number"], select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        input[type="number"]:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        button:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .preview {
            margin-top: 30px;
            text-align: center;
        }
        .hidden {
            display: none !important;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #videoOutput {
            max-width: 100%;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: black;
        }
        #downloadBtn {
            display: inline-block;
            margin-top: 20px;
            text-decoration: none;
        }
        #fileInfo {
            margin-top: 15px;
            font-size: 14px;
            color: #495057;
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
        }
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 10px;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
        .status-text {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #495057;
        }
        .file-input {
            display: none;
        }
        .icon {
            font-size: 24px;
        }
        .controls {
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Resimden Videoya D√∂n√º≈üt√ºr√ºc√º</h1>
        
        <div class="upload-area" id="uploadArea">
            <div id="uploadIcon" style="font-size: 50px; margin-bottom: 15px;">üìÅ</div>
            <p id="uploadText" style="font-size: 18px; margin-bottom: 10px;">Resmi s√ºr√ºkleyip bƒ±rakƒ±n veya tƒ±klayarak se√ßin</p>
            <p style="color: #6c757d; font-size: 14px;">(JPEG, PNG, GIF destekler)</p>
            <input type="file" id="imageInput" accept="image/*" class="file-input">
            <div id="fileInfo"></div>
        </div>
        
        <div class="settings">
            <div class="form-group">
                <label for="duration">üé¨ Video S√ºresi (saniye)</label>
                <input type="number" id="duration" min="1" max="60" value="5">
            </div>
            
            <div class="form-group">
                <label for="format">üìÅ √áƒ±ktƒ± Formatƒ±</label>
                <select id="format">
                    <option value="mp4">MP4 (En iyi kalite)</option>
                    <option value="webm">WebM (Daha k√º√ß√ºk boyut)</option>
                    <option value="gif">GIF (Animasyonlu)</option>
                </select>
            </div>
        </div>
        
        <div class="controls">
            <button id="convertBtn" disabled>
                <span class="icon">üé•</span>
                <span>Videoya D√∂n√º≈üt√ºr</span>
            </button>
        </div>
        
        <div class="preview">
            <div id="loadingAnimation" class="hidden">
                <div class="loader"></div>
                <div class="progress-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <p id="statusText" class="status-text">FFmpeg y√ºkleniyor, l√ºtfen bekleyin...</p>
            </div>
            
            <video id="videoOutput" controls class="hidden"></video>
            
            <a id="downloadBtn" class="hidden" download>
                <button>
                    <span class="icon">‚¨áÔ∏è</span>
                    <span>Videoyu ƒ∞ndir</span>
                </button>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementler
            const uploadArea = document.getElementById('uploadArea');
            const uploadIcon = document.getElementById('uploadIcon');
            const uploadText = document.getElementById('uploadText');
            const imageInput = document.getElementById('imageInput');
            const convertBtn = document.getElementById('convertBtn');
            const durationInput = document.getElementById('duration');
            const formatSelect = document.getElementById('format');
            const loadingAnimation = document.getElementById('loadingAnimation');
            const videoOutput = document.getElementById('videoOutput');
            const downloadBtn = document.getElementById('downloadBtn');
            const fileInfo = document.getElementById('fileInfo');
            const progressBar = document.getElementById('progressBar');
            const statusText = document.getElementById('statusText');
            
            let selectedImage = null;
            let ffmpeg = null;
            let isFFmpegReady = false;

            // FFmpeg'i y√ºkle
            async function loadFFmpeg() {
                if (ffmpeg && ffmpeg.isLoaded()) return;
                
                try {
                    statusText.textContent = "FFmpeg y√ºkleniyor (‚âà25MB), l√ºtfen bekleyin...";
                    
                    ffmpeg = createFFmpeg({ 
                        log: true,
                        corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js',
                        progress: ({ ratio }) => {
                            const percent = Math.round(ratio * 100);
                            progressBar.style.width = `${percent}%`;
                            statusText.textContent = `FFmpeg y√ºkleniyor: %${percent}`;
                        }
                    });
                    
                    await ffmpeg.load();
                    
                    statusText.textContent = "FFmpeg ba≈üarƒ±yla y√ºklendi!";
                    progressBar.style.width = "100%";
                    isFFmpegReady = true;
                    updateConvertButtonState();
                    
                    setTimeout(() => {
                        progressBar.style.width = "0%";
                    }, 1000);
                } catch (error) {
                    console.error("FFmpeg y√ºkleme hatasƒ±:", error);
                    statusText.textContent = "FFmpeg y√ºklenirken hata olu≈ütu! L√ºtfen sayfayƒ± yenileyin.";
                    isFFmpegReady = false;
                    updateConvertButtonState();
                }
            }
            
            // Buton durumunu g√ºncelle
            function updateConvertButtonState() {
                if (selectedImage && isFFmpegReady) {
                    convertBtn.disabled = false;
                    convertBtn.innerHTML = '<span class="icon">üé•</span><span>Videoya D√∂n√º≈üt√ºr</span>';
                } else {
                    convertBtn.disabled = true;
                    if (!isFFmpegReady) {
                        convertBtn.innerHTML = '<span class="icon">‚è≥</span><span>FFmpeg Y√ºkleniyor...</span>';
                    } else {
                        convertBtn.innerHTML = '<span class="icon">üé•</span><span>Videoya D√∂n√º≈üt√ºr</span>';
                    }
                }
            }

            // Sayfa y√ºklendiƒüinde FFmpeg'i y√ºkle
            loadFFmpeg();
            
            // Dosya y√ºkleme alanƒ± etkile≈üimleri
            uploadArea.addEventListener('click', () => imageInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('active');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('active');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('active');
                
                if (e.dataTransfer.files.length) {
                    handleImageFile(e.dataTransfer.files[0]);
                }
            });
            
            imageInput.addEventListener('change', () => {
                if (imageInput.files.length) {
                    handleImageFile(imageInput.files[0]);
                }
            });
            
            function handleImageFile(file) {
                if (!file.type.startsWith('image/')) {
                    showAlert("L√ºtfen bir resim dosyasƒ± se√ßin! (JPEG, PNG, GIF vb.)", "error");
                    return;
                }
                
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    if (!confirm(`Se√ßtiƒüiniz dosya boyutu √ßok b√ºy√ºk (${(file.size / 1024 / 1024).toFixed(1)}MB). Devam etmek istiyor musunuz? D√∂n√º≈ü√ºm uzun s√ºrebilir.`)) {
                        return;
                    }
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedImage = e.target.result;
                    // Sadece resmi ekleyip diƒüer elementleri koruyoruz
                    uploadIcon.style.display = 'none';
                    uploadText.style.display = 'none';
                    const imgPreview = document.createElement('img');
                    imgPreview.src = selectedImage;
                    imgPreview.style.maxWidth = '100%';
                    imgPreview.style.maxHeight = '300px';
                    imgPreview.style.borderRadius = '8px';
                    imgPreview.style.marginBottom = '15px';
                    uploadArea.insertBefore(imgPreview, fileInfo);
                    
                    fileInfo.textContent = `üìÑ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`;
                    fileInfo.style.display = 'block';
                    
                    updateConvertButtonState();
                };
                reader.readAsDataURL(file);
            }
            
            // D√∂n√º≈üt√ºrme butonu
            convertBtn.addEventListener('click', async () => {
                if (!selectedImage) return;
                
                const duration = parseInt(durationInput.value);
                const format = formatSelect.value;
                
                // Y√ºkleme animasyonunu g√∂ster
                loadingAnimation.classList.remove('hidden');
                videoOutput.classList.add('hidden');
                downloadBtn.classList.add('hidden');
                statusText.textContent = "Video olu≈üturuluyor...";
                
                try {
                    await createVideo(selectedImage, duration, format);
                } catch (error) {
                    console.error("D√∂n√º≈ü√ºm hatasƒ±:", error);
                    statusText.textContent = `Hata: ${error.message}`;
                    setTimeout(() => {
                        loadingAnimation.classList.add('hidden');
                    }, 3000);
                }
            });
            
            async function createVideo(imageData, duration, format) {
                if (!ffmpeg || !ffmpeg.isLoaded()) {
                    await loadFFmpeg();
                }
                
                // Resmi y√ºkle
                statusText.textContent = "Resim i≈üleniyor...";
                progressBar.style.width = "10%";
                
                const imageType = imageData.split(';')[0].split(':')[1];
                const extension = imageType.split('/')[1];
                const inputName = `input.${extension}`;
                
                try {
                    const response = await fetch(imageData);
                    const imageBlob = await response.blob();
                    await ffmpeg.FS('writeFile', inputName, await fetchFile(imageBlob));
                    
                    // FFmpeg komutunu √ßalƒ±≈ütƒ±r
                    statusText.textContent = "Video olu≈üturuluyor...";
                    progressBar.style.width = "30%";
                    
                    const outputName = `output.${format}`;
                    let command = [
                        '-loop', '1',
                        '-i', inputName,
                        '-t', duration.toString(),
                        '-vf', 'scale=trunc(iw/2)*2:trunc(ih/2)*2', // √áift sayƒ±ya yuvarla
                        '-pix_fmt', 'yuv420p'
                    ];
                    
                    // Format √∂zel ayarlar
                    if (format === 'mp4') {
                        command.push('-c:v', 'libx264', '-preset', 'medium', '-crf', '23');
                    } else if (format === 'webm') {
                        command.push('-c:v', 'libvpx-vp9', '-b:v', '1M', '-quality', 'good');
                    } else if (format === 'gif') {
                        command = [
                            '-i', inputName,
                            '-t', duration.toString(),
                            '-vf', 'fps=15,scale=640:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse',
                            '-loop', '0'
                        ];
                    }
                    
                    command.push(outputName);
                    
                    // FFmpeg √ßalƒ±≈ütƒ±r
                    await ffmpeg.run(...command);
                    progressBar.style.width = "80%";
                    statusText.textContent = "Video hazƒ±rlanƒ±yor...";
                    
                    // Sonucu al
                    const data = ffmpeg.FS('readFile', outputName);
                    const mimeType = format === 'gif' ? 'image/gif' : `video/${format}`;
                    const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: mimeType }));
                    
                    // Bellek temizle
                    ffmpeg.FS('unlink', inputName);
                    ffmpeg.FS('unlink', outputName);
                    
                    // Sonucu g√∂ster
                    progressBar.style.width = "100%";
                    statusText.textContent = "Video ba≈üarƒ±yla olu≈üturuldu!";
                    
                    setTimeout(() => {
                        loadingAnimation.classList.add('hidden');
                        videoOutput.src = videoUrl;
                        videoOutput.classList.remove('hidden');
                        downloadBtn.href = videoUrl;
                        downloadBtn.download = `video_${new Date().getTime()}.${format}`;
                        downloadBtn.classList.remove('hidden');
                        progressBar.style.width = "0%";
                    }, 500);
                    
                } catch (error) {
                    console.error("FFmpeg hatasƒ±:", error);
                    throw new Error("Video olu≈üturulurken teknik bir hata olu≈ütu.");
                }
            }
            
            function showAlert(message, type = 'info') {
                const alertBox = document.createElement('div');
                alertBox.style.position = 'fixed';
                alertBox.style.top = '20px';
                alertBox.style.right = '20px';
                alertBox.style.padding = '15px 25px';
                alertBox.style.borderRadius = '8px';
                alertBox.style.color = 'white';
                alertBox.style.fontWeight = 'bold';
                alertBox.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                alertBox.style.zIndex = '1000';
                alertBox.style.animation = 'slideIn 0.3s forwards';
                
                if (type === 'error') {
                    alertBox.style.background = 'var(--danger)';
                } else {
                    alertBox.style.background = 'var(--primary)';
                }
                
                alertBox.textContent = message;
                document.body.appendChild(alertBox);
                
                setTimeout(() => {
                    alertBox.style.animation = 'slideOut 0.3s forwards';
                    setTimeout(() => {
                        document.body.removeChild(alertBox);
                    }, 300);
                }, 3000);
            }
            
            // CSS animasyonlarƒ± i√ßin style ekle
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
